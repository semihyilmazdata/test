import{r as o,j as e}from"./index-DF-VfARk.js";import{u as L}from"./useUserContext-BfcVo3vY.js";import{U}from"./index-BzoxnAcz.js";import{A as u,T as w}from"./index-Pi5MhuwB.js";import{F as i}from"./index-e6vNLNv5.js";import{F as a,B as c}from"./index-CZ386Uyv.js";import{A as F}from"./index-DixPxxsU.js";import{I as s}from"./index-C3dcIk9B.js";import{P as I}from"./index-D_Jq7_Ot.js";import"./collapse-BbEVqHco.js";import"./row-CN7xCyZB.js";import"./responsiveObserver-BnMIucoH.js";import"./ExclamationCircleFilled-DrSG7Lz4.js";import"./useBreakpoint-DbOrmpLl.js";import"./pickAttrs-BTWl6K21.js";import"./index-BKkJNJXg.js";function R(){const{user:r,refetch:d}=L(),{mutateAsync:p}=u.authentication.logout.useMutation({onSuccess:t=>{t.redirect&&(window.location.href=t.redirect)}}),[l]=i.useForm(),[f,n]=o.useState(!1),[h,m]=o.useState(!1),{mutateAsync:g}=u.user.update.useMutation();o.useEffect(()=>{l.setFieldsValue(r)},[r]);const x=async t=>{n(!0);try{await g({where:{id:r.id},data:{email:t.email,name:t.name,pictureUrl:t.pictureUrl}}),d()}catch(y){console.error(`Could not save user: ${y.message}`,{variant:"error"})}n(!1)},j=async()=>{m(!0);try{await p()}catch(t){console.error(`Could not logout: ${t.message}`,{variant:"error"}),m(!1)}};return e.jsxs(I,{layout:"super-narrow",children:[e.jsxs(a,{justify:"space-between",align:"center",children:[e.jsx(w.Title,{level:1,children:"Profile"}),e.jsx(c,{onClick:j,loading:h,children:"Logout"})]}),e.jsx(a,{justify:"center",style:{marginBottom:"30px"},children:e.jsx(F,{size:80,src:r==null?void 0:r.pictureUrl,children:U.stringToInitials(r==null?void 0:r.name)})}),e.jsxs(i,{form:l,initialValues:r,onFinish:x,layout:"vertical",requiredMark:!1,children:[e.jsx(i.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:e.jsx(s,{})}),e.jsx(i.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Email is required"}],children:e.jsx(s,{type:"email",placeholder:"Your email",autoComplete:"email"})}),e.jsx(i.Item,{label:"Profile picture",name:"pictureUrl",children:e.jsx(s,{})}),e.jsx(i.Item,{children:e.jsx(a,{justify:"end",children:e.jsx(c,{type:"primary",htmlType:"submit",loading:f,children:"Save"})})})]})]})}export{R as default};
